# é«˜æ€§èƒ½æœ¬åœ°æœç´¢å¼•æ“

åŸºäº Java 21 + Gradle çš„é«˜æ€§èƒ½æœ¬åœ°æ–‡ä»¶å…¨æ–‡æœç´¢å¼•æ“ï¼Œä¸ä¾èµ– Lucene ç­‰æœç´¢æ¡†æ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **å…¨æ–‡æ£€ç´¢**ï¼šæ”¯æŒå€’æ’ç´¢å¼• + ä½ç½®ç´¢å¼•
- ğŸ“Š **BM25 è¯„åˆ†**ï¼šåŸºäº BM25 ç®—æ³•çš„ç›¸å…³æ€§æ’åº
- ğŸ“ **è‡ªå®šä¹‰ Query DSL**ï¼šæ”¯æŒå¸ƒå°”ã€çŸ­è¯­ã€å‰ç¼€ã€å­—æ®µè¿‡æ»¤ã€èŒƒå›´æŸ¥è¯¢
- ğŸš€ **å¢é‡æ›´æ–°**ï¼šåŸºäºæ–‡ä»¶ mtime/size çš„å¢é‡ç´¢å¼•
- ğŸ’¾ **å´©æºƒæ¢å¤**ï¼šWALï¼ˆé¢„å†™æ—¥å¿—ï¼‰ä¿è¯æ•°æ®ä¸ä¸¢å¤±
- ğŸ”„ **æ®µåˆå¹¶**ï¼šTiered Merge ç­–ç•¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- ğŸ¨ **CLI äº¤äº’**ï¼šæ”¯æŒ index/search/status/rebuild å››å­å‘½ä»¤

## æŠ€æœ¯æ ˆ

- **Java 21 LTS**
- **Gradle 8.6** (Kotlin DSL)
- **SQLite**ï¼šæ–‡æ¡£å…ƒæ•°æ®å­˜å‚¨
- **picocli**ï¼šå‘½ä»¤è¡Œæ¥å£
- **Jackson**ï¼šJSON åºåˆ—åŒ–
- **Logback**ï¼šæ—¥å¿—ç®¡ç†
- **JMH**ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•
- **JaCoCo**ï¼šä»£ç è¦†ç›–ç‡

## å¿«é€Ÿå¼€å§‹

### 1. æ„å»ºé¡¹ç›®

```bash
./gradlew build
```

### 1.1 å¯åŠ¨å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰

```bash
./gradlew run --args="--gui"
```

### 2. æ„å»ºç´¢å¼•

```bash
./gradlew run --args="index /path/to/documents"
```

### 3. æœç´¢æŸ¥è¯¢

```bash
# ç®€å•æŸ¥è¯¢
./gradlew run --args='search "java programming"'

# çŸ­è¯­æŸ¥è¯¢
./gradlew run --args='search "\"distributed system\""'

# å¸ƒå°”æŸ¥è¯¢
./gradlew run --args='search "error AND (timeout OR retry)"'

# å­—æ®µè¿‡æ»¤
./gradlew run --args='search "ext:md type:code"'

# èŒƒå›´æŸ¥è¯¢
./gradlew run --args='search "mtime:2025-01-01..2025-12-31"'
```

### 4. æŸ¥çœ‹ç´¢å¼•çŠ¶æ€

```bash
./gradlew run --args="status"
```

### 5. é‡å»ºç´¢å¼•

```bash
./gradlew run --args="rebuild --yes /path/to/documents"
```

## ä½¿ç”¨è¯´æ˜

### 1) å¯åŠ¨æ–¹å¼

- CLIï¼š`./gradlew run --args="--help"`
- GUIï¼š`./gradlew run --args="--gui"`

### 2) GUI æ“ä½œæµç¨‹

1. é¡¶éƒ¨é…ç½® `ç´¢å¼•ç›®å½•` ä¸ `çº¿ç¨‹æ•°`ã€‚
2. åœ¨â€œç´¢å¼•â€é¡µç­¾å¡«å…¥æºè·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶ï¼‰ï¼Œç‚¹å‡»â€œæ„å»º/å¢é‡ç´¢å¼•â€ã€‚
3. åœ¨â€œæœç´¢â€é¡µç­¾è¾“å…¥æŸ¥è¯¢è¯­å¥å¹¶æ‰§è¡Œæœç´¢ã€‚
4. å¯ä½¿ç”¨â€œæ–‡ä»¶åå¿«é€Ÿæ£€ç´¢â€ç›´æ¥æŒ‰æ–‡ä»¶åæœç´¢ï¼ˆè‡ªåŠ¨è½¬ä¸º `filename:"xxx"`ï¼‰ã€‚
5. åœ¨â€œçŠ¶æ€â€é¡µç­¾ç‚¹å‡»â€œåˆ·æ–°çŠ¶æ€â€æŸ¥çœ‹æ–‡æ¡£æ•°ã€è¯æ¡æ•°ã€æ®µæ•°ä¸ç´¢å¼•å¤§å°ã€‚

### 3) æŸ¥è¯¢ç¤ºä¾‹

- å…¨æ–‡ï¼š`java programming`
- çŸ­è¯­ï¼š`"distributed system"`
- å¸ƒå°”ï¼š`error AND (timeout OR retry)`
- æ‰©å±•åï¼š`ext:md`
- ç±»å‹ï¼š`type:note`
- è·¯å¾„å‰ç¼€ï¼š`path:C:/work/docs`
- æ–‡ä»¶åï¼š`filename:PROJECT_SPEC.md`
- ç›´æ¥æ–‡ä»¶åï¼š`PROJECT_SPEC.md`ï¼ˆä¼šè‡ªåŠ¨æŒ‰æ–‡ä»¶åè¿‡æ»¤ï¼‰

### 4) ç»“æœé«˜äº®

- CLI ä¸­é«˜äº®ç”± ANSI æ§åˆ¶åºåˆ—å®ç°ã€‚
- GUI ä¸­é«˜äº®ç”±å¯Œæ–‡æœ¬æ¸²æŸ“å®ç°ï¼ˆé»„è‰²èƒŒæ™¯ï¼‰ï¼Œç”¨äºç›´è§‚çœ‹åˆ°å‘½ä¸­ç‰‡æ®µã€‚

## åˆ†å‘ä¸å®‰è£…åŒ…ï¼ˆWindows EXEï¼‰

### 1) å…ˆå†³æ¡ä»¶

- Java 21ï¼ˆå·²åŒ…å« `jpackage`ï¼‰ã€‚
- `JAVA_HOME` æ­£ç¡®æŒ‡å‘ JDK ç›®å½•ã€‚
- è‹¥è¦ç”Ÿæˆ `exe` å®‰è£…åŒ…ï¼Œéœ€å®‰è£… WiX Toolsetï¼ˆjpackage åœ¨ Windows ç”Ÿæˆ exe çš„ä¾èµ–ï¼‰ã€‚

### 2) ç”Ÿæˆäº§ç‰©

```bash
# ç”Ÿæˆå¯åˆ†å‘ app-imageï¼ˆä¸ä¾èµ– WiXï¼‰
./gradlew packageAppImage

# ç”Ÿæˆå¯ç›´æ¥ç»™ç”¨æˆ·ä¸‹è½½çš„ä¾¿æºç‰ˆ zipï¼ˆæ¨èï¼‰
./gradlew packagePortableZip

# ç”Ÿæˆ Windows EXE å®‰è£…åŒ…ï¼ˆä¾èµ– WiXï¼‰
./gradlew packageExe
```

äº§ç‰©è·¯å¾„ï¼š

- app-imageï¼ˆæ¨èç›´æ¥åˆ†å‘ï¼‰ï¼š`build/distributions/appimage/LocalSearchEnginePortable/LocalSearchEnginePortable.exe`
- ä¾¿æºç‰ˆ zipï¼ˆæ¨èåˆ†å‘ï¼‰ï¼š`build/distributions/LocalSearchEnginePortable-1.0.0.zip`
- exe å®‰è£…åŒ…ï¼š`build/distributions/`ï¼ˆéœ€ WiX 3.xï¼‰

æ³¨æ„ï¼š`packageExe` ä¾èµ– WiX 3.xï¼ˆéœ€è¦ `candle.exe`ã€`light.exe`ï¼‰ã€‚è‹¥ç¼ºå¤±è¯¥ç¯å¢ƒï¼Œå¯å…ˆåˆ†å‘ app-image ç›®å½•ï¼ˆå°†æ•´ä¸ªç›®å½•æ‰“åŒ… zip ç»™ç”¨æˆ·ï¼‰ã€‚

### 3) åˆ†å‘å»ºè®®

- éœ€è¦â€œå¼€ç®±å³ç”¨â€å®‰è£…ä½“éªŒï¼šåˆ†å‘ `packageExe` ç”Ÿæˆçš„ `.exe`ã€‚
- éœ€è¦å…å®‰è£…ç»¿è‰²ç‰ˆï¼šä¼˜å…ˆåˆ†å‘ `packagePortableZip` ç”Ÿæˆçš„ zipã€‚

## Query DSL è¯­æ³•

```
hello world                    # éšå¼ AND
"distributed system"           # çŸ­è¯­æŸ¥è¯¢
config*                        # å‰ç¼€åŒ¹é…
error AND (timeout OR retry)   # å¸ƒå°”ç»„åˆ
-draft NOT internal            # æ’é™¤
ext:md type:note               # å­—æ®µè¿‡æ»¤
filename:readme.md             # æŒ‰æ–‡ä»¶åè¿‡æ»¤
mtime:2025-01-01..2025-12-31   # æ—¥æœŸèŒƒå›´
size:10KB..5MB                 # å¤§å°èŒƒå›´
path:/work/src                 # è·¯å¾„å‰ç¼€
sort:mtime                     # æŒ‰ä¿®æ”¹æ—¶é—´æ’åº
```

è¯´æ˜ï¼šå½“ä½ ç›´æ¥è¾“å…¥ç±»ä¼¼ `readme.md` è¿™ç§å¸¦æ‰©å±•åçš„å•è¯é¡¹æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰æ–‡ä»¶åè¿‡æ»¤å¤„ç†ã€‚

## æ€§èƒ½æŒ‡æ ‡

- **æ•°æ®è§„æ¨¡**ï¼šæ”¯æŒ 10 ä¸‡æ–‡ä»¶ï¼Œ5GB æ–‡æœ¬
- **ç´¢å¼•æ—¶é—´**ï¼šå…¨é‡ â‰¤ 5 åˆ†é’Ÿï¼ˆSSDï¼‰
- **æŸ¥è¯¢å»¶è¿Ÿ**ï¼šP99 â‰¤ 50ms
- **å´©æºƒæ¢å¤**ï¼šWAL ä¿è¯ç´¢å¼•å…ƒæ•°æ®ä¸€è‡´æ€§ä¸å¯æ¢å¤åˆ°æœ€è¿‘æäº¤ç‚¹

## é¡¹ç›®ç»“æ„

```
local-search-engine/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/com/localengine/
â”‚   â”‚   â”œâ”€â”€ cli/          # CLI å±‚
â”‚   â”‚   â”œâ”€â”€ config/       # é…ç½®
â”‚   â”‚   â”œâ”€â”€ document/     # æ–‡æ¡£æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ highlight/    # é«˜äº®æ‘˜è¦
â”‚   â”‚   â”œâ”€â”€ index/        # ç´¢å¼•å±‚
â”‚   â”‚   â”œâ”€â”€ query/        # æŸ¥è¯¢å¼•æ“
â”‚   â”‚   â”œâ”€â”€ scoring/      # è¯„åˆ†ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ storage/      # å­˜å‚¨å±‚
â”‚   â”‚   â””â”€â”€ text/         # åˆ†è¯å™¨
â”‚   â”œâ”€â”€ test/             # æµ‹è¯•
â”‚   â””â”€â”€ jmh/              # JMH åŸºå‡†æµ‹è¯•
â”œâ”€â”€ docs/                 # è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ build.gradle.kts      # Gradle é…ç½®
â””â”€â”€ README.md            # æœ¬æ–‡ä»¶
```

## æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
./gradlew test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./gradlew jacocoTestReport

# è¿è¡Œ JMH åŸºå‡†æµ‹è¯•
./gradlew jmh
```

## è®¸å¯è¯

MIT License
